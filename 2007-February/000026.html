<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [pvpgn-dev] r254 - in trunk/pvpgn: conf src/bnetd src/common
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/pvpgn-dev/2007-February/index.html" >
   <LINK REL="made" HREF="mailto:pvpgn-dev%40lists.berlios.de?Subject=Re%3A%20%5Bpvpgn-dev%5D%20r254%20-%20in%20trunk/pvpgn%3A%20conf%20src/bnetd%20src/common&In-Reply-To=%3C200702131854.l1DIs2gW017391%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000022.html">
   <LINK REL="Next"  HREF="000027.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[pvpgn-dev] r254 - in trunk/pvpgn: conf src/bnetd src/common</H1>
    <B>svn at svn.berlios.de</B> 
    <A HREF="mailto:pvpgn-dev%40lists.berlios.de?Subject=Re%3A%20%5Bpvpgn-dev%5D%20r254%20-%20in%20trunk/pvpgn%3A%20conf%20src/bnetd%20src/common&In-Reply-To=%3C200702131854.l1DIs2gW017391%40sheep.berlios.de%3E"
       TITLE="[pvpgn-dev] r254 - in trunk/pvpgn: conf src/bnetd src/common">svn at svn.berlios.de
       </A><BR>
    <I>Tue Feb 13 19:54:02 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000022.html">[pvpgn-dev] [Patch #1643] support for Emperor and Red Alert 1 v3.03
</A></li>
        <LI>Next message: <A HREF="000027.html">[pvpgn-dev] [Patch #1643] support for Emperor and Red Alert 1 v3.03
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26">[ date ]</a>
              <a href="thread.html#26">[ thread ]</a>
              <a href="subject.html#26">[ subject ]</a>
              <a href="author.html#26">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: d1zzy
Date: 2007-02-13 19:53:59 +0100 (Tue, 13 Feb 2007)
New Revision: 254

Modified:
   trunk/pvpgn/conf/bnetd.conf.in
   trunk/pvpgn/conf/bnetd.conf.win32
   trunk/pvpgn/conf/channel.conf
   trunk/pvpgn/src/bnetd/channel.cpp
   trunk/pvpgn/src/bnetd/channel.h
   trunk/pvpgn/src/bnetd/connection.cpp
   trunk/pvpgn/src/bnetd/connection.h
   trunk/pvpgn/src/bnetd/handle_wol.cpp
   trunk/pvpgn/src/bnetd/irc.cpp
   trunk/pvpgn/src/bnetd/message.cpp
   trunk/pvpgn/src/bnetd/message.h
   trunk/pvpgn/src/bnetd/prefs.cpp
   trunk/pvpgn/src/bnetd/prefs.h
   trunk/pvpgn/src/bnetd/server.cpp
   trunk/pvpgn/src/bnetd/server.h
   trunk/pvpgn/src/common/irc_protocol.h
   trunk/pvpgn/src/common/setup_before.h
   trunk/pvpgn/src/common/tag.cpp
   trunk/pvpgn/src/common/tag.h
Log:
Commited patch #1643 from pelish (with minor modifications). Major 
changes: added buddies support, fixed some WOL bugs, added support for 
Emperor battle for dune 1.09 and redalert 3.03.


Modified: trunk/pvpgn/conf/bnetd.conf.in
===================================================================
--- trunk/pvpgn/conf/bnetd.conf.in	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/conf/bnetd.conf.in	2007-02-13 18:53:59 UTC (rev 254)
@@ -515,6 +515,7 @@
 
 #woladdrs = &quot;:4000&quot;
 #wservaddrs = &quot;:4005&quot;
+#wgameresaddrs = &quot;:4807&quot;
 
 # Just leave these as default (unless you know the timezone, longitiude and latitude
 # of your server

Modified: trunk/pvpgn/conf/bnetd.conf.win32
===================================================================
--- trunk/pvpgn/conf/bnetd.conf.win32	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/conf/bnetd.conf.win32	2007-02-13 18:53:59 UTC (rev 254)
@@ -493,6 +493,7 @@
 
 #woladdrs = &quot;:4000&quot;
 #wservaddrs = &quot;:4005&quot;
+#wgameresaddrs = &quot;:4807&quot;
 
 # Just leave these as default (unless you know the timezone, longitiude and latitude
 # of your server

Modified: trunk/pvpgn/conf/channel.conf
===================================================================
--- trunk/pvpgn/conf/channel.conf	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/conf/channel.conf	2007-02-13 18:53:59 UTC (rev 254)
@@ -77,7 +77,7 @@
 &quot;Lob 18 2&quot;                    &quot;GDI Comm. Center&quot;        TSUN    false false false  NULL   NULL    -1   false
 
 ##### Red Alert 1 Support ######################################################################################
-&quot;Lob 21 0&quot;                    &quot;Combat Alley&quot;            WWOL    false false false  NULL   NULL    -1   false
+&quot;Lob 21 0&quot;                    &quot;Combat Alley&quot;            RALT    false false false  NULL   NULL    -1   false
 
 ##### Red Alert 2 Support ######################################################################################
 &quot;Lob 33 0&quot;                    &quot;USA Command&quot;             RAL2    false false false  NULL   NULL    -1   false
@@ -91,7 +91,7 @@
 &quot;Lob 41 1&quot;                    &quot;Unknown&quot;                 YURI    false false false  NULL   NULL    -1   false
 
 ##### Emperor: Battle for Dune #################################################################################
-&quot;Emperor-1&quot;                   &quot;Unknown&quot;                 EMPR    false false false  NULL   NULL    -1   false
+&quot;Emperor-1&quot;                   &quot;Emperor-1&quot;               EMPR    false false false  NULL   NULL    -1   false
 
 #                                                                            #
 ##############################################################################

Modified: trunk/pvpgn/src/bnetd/channel.cpp
===================================================================
--- trunk/pvpgn/src/bnetd/channel.cpp	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/channel.cpp	2007-02-13 18:53:59 UTC (rev 254)
@@ -237,6 +237,7 @@
 
     channel-&gt;gameType = 0;
     channel-&gt;gameTournament = 0;
+    channel-&gt;gameExtension = NULL;
 
     channel-&gt;gameOptions = NULL;
 
@@ -272,6 +273,9 @@
 
     eventlog(eventlog_level_info,__FUNCTION__,&quot;destroying channel \&quot;%s\&quot;&quot;,channel-&gt;name);
 
+    if (channel-&gt;gameExtension)
+        xfree(channel-&gt;gameExtension);
+
     LIST_TRAVERSE(channel-&gt;banlist,ban)
     {
 	char const * banned;
@@ -1263,6 +1267,19 @@
   return channel-&gt;maxmembers;
 }
 
+extern int channel_set_max(t_channel * channel, int maxmembers)
+{
+	if (!channel)
+	{
+	  eventlog(eventlog_level_error,__FUNCTION__,&quot;got NULL channel&quot;);
+	  return 0;
+	}
+
+	if (maxmembers)
+ 	   channel-&gt;maxmembers = maxmembers;
+    return 1;
+}
+
 extern int channel_get_curr(t_channel const * channel)
 {
   if (!channel)
@@ -1669,6 +1686,34 @@
 	return 1;
 }
 
+extern char const * channel_wol_get_game_extension(t_channel const * channel)
+{
+	if (!channel)
+	{
+	  eventlog(eventlog_level_error,__FUNCTION__,&quot;got NULL channel&quot;);
+	  return NULL;
+	}
+
+    return channel-&gt;gameExtension;
 }
 
+extern int channel_wol_set_game_extension(t_channel * channel, char const * gameExtension)
+{
+	if (!channel)
+	{
+	  eventlog(eventlog_level_error,__FUNCTION__,&quot;got NULL channel&quot;);
+	  return -1;
+	}
+
+	if (channel-&gt;gameExtension)
+	    xfree(channel-&gt;gameExtension);
+
+	channel-&gt;gameExtension = gameExtension ? xstrdup(gameExtension) : 0;
+
+	return 0;
 }
+
+
+}
+
+}

Modified: trunk/pvpgn/src/bnetd/channel.h
===================================================================
--- trunk/pvpgn/src/bnetd/channel.h	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/channel.h	2007-02-13 18:53:59 UTC (rev 254)
@@ -102,6 +102,7 @@
 
     int               gameType;
     int               gameTournament;
+    char const *      gameExtension;
 
     char const *      gameOptions;
 }
@@ -158,6 +159,7 @@
 extern t_list * channel_get_banlist(t_channel const * channel);
 extern int channel_get_length(t_channel const * channel);
 extern int channel_get_max(t_channel const * channel);
+extern int channel_set_max(t_channel * channel, int maxmembers);
 extern int channel_get_curr(t_channel const * channel);
 extern int channel_conn_is_tmpOP(t_channel const * channel, t_connection * c);
 extern int channel_conn_has_tmpVOICE(t_channel const * channel, t_connection * c);
@@ -190,6 +192,9 @@
 extern char const * channel_wol_get_game_options(t_channel const * channel);
 extern int channel_wol_set_game_options(t_channel * channel, char const * gameOptions);
 
+extern char const * channel_wol_get_game_extension(t_channel const * channel);
+extern int channel_wol_set_game_extension(t_channel * channel, char const * gameExtension);
+
 }
 
 }

Modified: trunk/pvpgn/src/bnetd/connection.cpp
===================================================================
--- trunk/pvpgn/src/bnetd/connection.cpp	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/connection.cpp	2007-02-13 18:53:59 UTC (rev 254)
@@ -114,7 +114,7 @@
 
     if (c-&gt;protocol.cflags &amp; conn_flags_welcomed)
 	return;
-    if ((conn_get_class(c)==conn_class_irc)||(conn_get_class(c)==conn_class_wol)||(conn_get_class(c)==conn_class_wserv))
+    if ((conn_get_class(c)==conn_class_irc)||(conn_get_class(c)==conn_class_wol)||(conn_get_class(c)==conn_class_wserv)||(conn_get_class(c)==conn_class_wgameres))
     {
 	c-&gt;protocol.cflags|= conn_flags_welcomed;
 	return;
@@ -196,7 +196,7 @@
     	return;					// state_destroy: do nothing
 
 
-    if ((conn_get_class(c)==conn_class_irc)||(conn_get_class(c)==conn_class_wol)||(conn_get_class(c)==conn_class_wserv)) {
+    if ((conn_get_class(c)==conn_class_irc)||(conn_get_class(c)==conn_class_wol)||(conn_get_class(c)==conn_class_wserv)||(conn_get_class(c)==conn_class_wgameres)) {
     	/* We should start pinging the client after we received the first line ... */
     	/* NOTE: RFC2812 only suggests that PINGs are being sent
     	 * if no other activity is detected. However it explecitly
@@ -282,6 +282,8 @@
     return &quot;wol&quot;;
 	case conn_class_wserv:
     return &quot;wserv&quot;;
+	case conn_class_wgameres:
+    return &quot;wgameres&quot;;
     case conn_class_none:
 	return &quot;none&quot;;
 	case conn_class_w3route:
@@ -1948,8 +1950,7 @@
       message_send_text(c,message_type_info,c,msgtemp);
     }
 
-    if (channel_get_topic(channel_get_name(c-&gt;protocol.chat.channel)) &amp;&amp; ((conn_get_class(c)!=conn_class_irc) ||
-        (conn_get_class(c)!=conn_class_wol) || (conn_get_class(c)!=conn_class_wserv)))
+    if (channel_get_topic(channel_get_name(c-&gt;protocol.chat.channel)) &amp;&amp; ((conn_get_class(c)!=conn_class_irc)))
     {
       char msgtemp[MAX_MESSAGE_LEN];
 
@@ -3500,7 +3501,9 @@
     {
 	c = (const t_connection*)elem_get_data(curr);
 	if ((c-&gt;protocol.state==conn_state_loggedin)&amp;&amp;
-	    ((c-&gt;protocol.cclass==conn_class_bnet)||(c-&gt;protocol.cclass==conn_class_bot)||(c-&gt;protocol.cclass==conn_class_telnet)||(c-&gt;protocol.cclass==conn_class_irc)||(c-&gt;protocol.cclass==conn_class_wol)||(c-&gt;protocol.cclass==conn_class_wserv)))
+	    ((c-&gt;protocol.cclass==conn_class_bnet)||(c-&gt;protocol.cclass==conn_class_bot)||(c-&gt;protocol.cclass==conn_class_telnet)
+          ||(c-&gt;protocol.cclass==conn_class_irc)||(c-&gt;protocol.cclass==conn_class_wol)||(c-&gt;protocol.cclass==conn_class_wserv)
+          ||(c-&gt;protocol.cclass==conn_class_wgameres)))
 	    count++;
     }
 
@@ -3950,7 +3953,7 @@
     if (!c)
     {
     	eventlog(eventlog_level_error,__FUNCTION__,&quot;got NULL conn&quot;);
-    	return -1;
+    	return 0;
     }
 
     return c-&gt;protocol.wol.findme;
@@ -3973,7 +3976,7 @@
     if (!c)
     {
     	eventlog(eventlog_level_error,__FUNCTION__,&quot;got NULL conn&quot;);
-    	return -1;
+    	return 0;
     }
 
     return c-&gt;protocol.wol.pageme;

Modified: trunk/pvpgn/src/bnetd/connection.h
===================================================================
--- trunk/pvpgn/src/bnetd/connection.h	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/connection.h	2007-02-13 18:53:59 UTC (rev 254)
@@ -70,9 +70,10 @@
     conn_class_file,
     conn_class_bot,
     conn_class_telnet,
-    conn_class_irc,     /* Internet Relay Chat */
-    conn_class_wol,     /* Westwood Online */
-    conn_class_wserv,   /* Westwood Server */
+    conn_class_irc,        /* Internet Relay Chat */
+    conn_class_wol,        /* Westwood IRC */
+    conn_class_wserv,      /* Westwood servserv */
+    conn_class_wgameres,   /* Westwood gameres */
     conn_class_d2cs_bnetd,
     conn_class_w3route,
     conn_class_none

Modified: trunk/pvpgn/src/bnetd/handle_wol.cpp
===================================================================
--- trunk/pvpgn/src/bnetd/handle_wol.cpp	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/handle_wol.cpp	2007-02-13 18:53:59 UTC (rev 254)
@@ -45,6 +45,7 @@
 #include &quot;tick.h&quot;
 #include &quot;topic.h&quot;
 #include &quot;server.h&quot;
+#include &quot;friends.h&quot;
 #include &quot;common/setup_after.h&quot;
 
 namespace pvpgn
@@ -96,6 +97,16 @@
 static int _handle_listsearch_command(t_connection * conn, int numparams, char ** params, char * text);
 static int _handle_advertr_command(t_connection * conn, int numparams, char ** params, char * text);
 static int _handle_chanchk_command(t_connection * conn, int numparams, char ** params, char * text);
+static int _handle_getbuddy_command(t_connection * conn, int numparams, char ** params, char * text);
+static int _handle_addbuddy_command(t_connection * conn, int numparams, char ** params, char * text);
+static int _handle_delbuddy_command(t_connection * conn, int numparams, char ** params, char * text);
+static int _handle_time_command(t_connection * conn, int numparams, char ** params, char * text);
+static int _handle_kick_command(t_connection * conn, int numparams, char ** params, char * text);
+static int _handle_mode_command(t_connection * conn, int numparams, char ** params, char * text);
+static int _handle_host_command(t_connection * conn, int numparams, char ** params, char * text);
+static int _handle_advertc_command(t_connection * conn, int numparams, char ** params, char * text);
+static int _handle_clanbyname_command(t_connection * conn, int numparams, char ** params, char * text);
+static int _handle_userip_command(t_connection * conn, int numparams, char ** params, char * text);
 
 /* state &quot;connected&quot; handlers */
 static const t_wol_command_table_row wol_con_command_table[] =
@@ -135,13 +146,23 @@
 	{ &quot;GETINSIDER&quot;	, _handle_getinsider_command },
 	{ &quot;JOINGAME&quot;	, _handle_joingame_command },
 	{ &quot;GAMEOPT&quot;		, _handle_gameopt_command },
+    { &quot;FINDUSER&quot;	, _handle_finduser_command },
 	{ &quot;FINDUSEREX&quot;	, _handle_finduserex_command },
-    { &quot;FINDUSER&quot;	, _handle_finduser_command },
 	{ &quot;PAGE&quot;		, _handle_page_command },
 	{ &quot;STARTG&quot;		, _handle_startg_command },
 	{ &quot;LISTSEARCH&quot;	, _handle_listsearch_command },
     { &quot;ADVERTR&quot;	    , _handle_advertr_command },
     { &quot;CHANCHK&quot;	    , _handle_chanchk_command },
+    { &quot;GETBUDDY&quot;    , _handle_getbuddy_command },
+    { &quot;ADDBUDDY&quot;    , _handle_addbuddy_command },
+    { &quot;DELBUDDY&quot;    , _handle_delbuddy_command },
+    { &quot;TIME&quot;        , _handle_time_command },
+	{ &quot;KICK&quot;		, _handle_kick_command },
+	{ &quot;MODE&quot;		, _handle_mode_command },
+	{ &quot;HOST&quot;		, _handle_host_command },
+	{ &quot;ADVERTC&quot;		, _handle_advertc_command },
+	{ &quot;CLANBYNAME&quot;	, _handle_clanbyname_command },
+	{ &quot;USERIP&quot;	    , _handle_userip_command },
 
 	{ NULL			, NULL }
 };
@@ -163,7 +184,7 @@
            conn_set_clienttag(conn,CLIENTTAG_WCHAT_UINT);
 //           conn_set_clienttag(conn,CLIENTTAG_CNCONQUER_UINT);
            return 0;
-      case 1005:  /* Red Alert 1 v2.02 (Westwood Chat Version) */
+      case 1005:  /* Red Alert 1 v2.00 (Westwood Chat Version) */
       case 1006:
       case 1007:
       case 1008:
@@ -203,11 +224,11 @@
       case 4615:
            conn_set_clienttag(conn,CLIENTTAG_TIBERNSUN_UINT);
            return 0;
-//      case 5376:  /* Red Alert 1 v3.03 (4 Players Internet Version) */
-//      case 5378:
-//      case 5379:
-//           conn_set_clienttag(conn,CLIENTTAG_REDALERT_UINT);
-//           return 0;
+      case 5376:  /* Red Alert 1 v3.03 (4 Players Internet Version) */
+      case 5378:
+      case 5379:
+           conn_set_clienttag(conn,CLIENTTAG_REDALERT_UINT);
+           return 0;
       case 7168:  /* Tiberian Sun: Firestorm */
       case 7170:
       case 7171:
@@ -392,17 +413,7 @@
 
 	if (handle_wol_con_command(conn, command, numparams, params, text)!=-1) {}
     else if (conn_get_state(conn)!=conn_state_loggedin) {
-	char temp[MAX_IRC_MESSAGE_LEN+1];
-
-/** 
- * NOTICE: DELETE because in WOL isnt used!
- *	if ((38+std::strlen(command)+16+1)&lt;sizeof(temp)) {
- *	    snprintf(temp, sizeof(temp), &quot;:Unrecognized command \&quot;%s\&quot; (before login)&quot;, command);
- *	    irc_send(conn,ERR_UNKNOWNCOMMAND,temp);
- *	} else {
- *	    irc_send(conn,ERR_UNKNOWNCOMMAND,&quot;:Unrecognized command (before login)&quot;);
- *	}
- */
+	     char temp[MAX_IRC_MESSAGE_LEN+1];
     } else {
         /* command is handled later */
 	unrecognized_before = 1;
@@ -431,7 +442,6 @@
     /* This function need rewrite */
     
     irc_send_motd(conn);
-    message_send_text(conn,message_type_notice,NULL,&quot;This is an experimental service.&quot;);
 
     conn_set_state(conn,conn_state_bot_password);
     if (connlist_find_connection_by_accountname(conn_get_loggeduser(conn))) {
@@ -459,7 +469,7 @@
 	eventlog(eventlog_level_error,__FUNCTION__,&quot;got NULL packet&quot;);
 	return -1;
     }
-    if (conn_get_class(conn) != conn_class_wol &amp;&amp; conn_get_class(conn) != conn_class_wserv) {
+    if (conn_get_class(conn) != conn_class_wol &amp;&amp; conn_get_class(conn) != conn_class_wserv &amp;&amp; conn_get_class(conn) != conn_class_wgameres) {
 	eventlog(eventlog_level_error,__FUNCTION__,&quot;FIXME: handle_wol_packet without any reason (conn-&gt;class != conn_class_wol &amp;&amp; conn-&gt;class != conn_class_wserv)&quot;);
 	return -1;
     }
@@ -841,7 +851,7 @@
 			    if((std::strstr(tempname,&quot;Lob&quot;) != NULL) || (std::strstr(tempname,&quot;Emperor&quot;) != NULL)) {
                      eventlog(eventlog_level_debug,__FUNCTION__,&quot;[** WOL **] LIST [Channel: \&quot;Lob\&quot;] (%s)&quot;,tempname);
 				     if (std::strlen(tempname)+1+20+1+1&lt;MAX_IRC_MESSAGE_LEN)
-					     snprintf(temp, sizeof(temp), &quot;%s %u 0 388&quot;,tempname,channel_get_length(channel));
+					     snprintf(temp, sizeof(temp), &quot;%s %u 0 388:&quot;,tempname,channel_get_length(channel));
  				     else
    					     eventlog(eventlog_level_warn,__FUNCTION__,&quot;LISTREPLY length exceeded&quot;);
                      irc_send(conn,RPL_CHANNEL,temp);
@@ -866,7 +876,7 @@
        (std::strcmp(params[0], &quot;31&quot;) == 0) ||
        (std::strcmp(params[0], &quot;33&quot;) == 0) ||
        (std::strcmp(params[0], &quot;37&quot;) == 0) ||
-       (std::strcmp(params[0], &quot;41&quot;))) {
+       (std::strcmp(params[0], &quot;41&quot;) == 0)) {
    		    eventlog(eventlog_level_debug,__FUNCTION__,&quot;[** WOL **] LIST [Game]&quot;);
        	    LIST_TRAVERSE_CONST(channellist(),curr)
             {
@@ -876,35 +886,36 @@
 				char * topic = channel_get_topic(channel_get_name(channel));
 
         	    tempname = irc_convert_channel(channel);
-				if((std::strstr(tempname,&quot;_game&quot;) != NULL) || (std::strstr(tempname,&quot;_Game&quot;) != NULL)) {
+        	    
+				if((channel_wol_get_game_type(channel) != 0)) {
 					m = channel_get_first(channel);
 					if((channel_wol_get_game_type(channel) == conn_wol_get_game_type(conn)) || ((numparams == 0))) {
 						eventlog(eventlog_level_debug,__FUNCTION__,&quot;[** WOL **] List [Channel: \&quot;_game\&quot;] (%s)&quot;,tempname);
 						
-						eventlog(eventlog_level_debug,__FUNCTION__,&quot;[** WOL **] List [Channel: \&quot;_game\&quot;] %s %u 0 %u %u 0 %u 128::&quot;,tempname,
+						eventlog(eventlog_level_debug,__FUNCTION__,&quot;[** WOL **] List [Channel: \&quot;_game\&quot;] %s %u 0 %u %u %s %u 128::&quot;,tempname,
 									 channel_get_length(channel),channel_wol_get_game_type(channel),channel_wol_get_game_tournament(channel),
-									 channel_wol_get_game_ownerip(channel));
+									 channel_wol_get_game_extension(channel),channel_wol_get_game_ownerip(channel));
 
 						if (topic) {
-	    					eventlog(eventlog_level_debug,__FUNCTION__,&quot;[** WOL **] List [Channel: \&quot;_game\&quot;] %s %u 0 %u %u 0 %u 128::%s&quot;,tempname,
+	    					eventlog(eventlog_level_debug,__FUNCTION__,&quot;[** WOL **] List [Channel: \&quot;_game\&quot;] %s %u 0 %u %u %s %u 128::%s&quot;,tempname,
 									 channel_get_length(channel),channel_wol_get_game_type(channel),channel_wol_get_game_tournament(channel),
-									 channel_wol_get_game_ownerip(channel),topic);
+									 channel_wol_get_game_extension(channel),channel_wol_get_game_ownerip(channel),topic);
 							/**
 							*  The layout of the game list entry is something like this:
                             *  
-							*   #game_channel_name users unknown gameType gameIsTournment unknown longIP 128::topic
+							*   #game_channel_name users unknown gameType gameIsTournment gameExtension longIP 128::topic
 							*/
 	        		        if (std::strlen(tempname)+1+20+1+1+std::strlen(topic)&lt;MAX_IRC_MESSAGE_LEN)
-                                   snprintf(temp, sizeof(temp), &quot;%s %u 0 %u %u 0 %u 128::%s&quot;,tempname,
+                                   snprintf(temp, sizeof(temp), &quot;%s %u 0 %u %u %s %u 128::%s&quot;,tempname,
                                          channel_get_length(channel),channel_wol_get_game_type(channel),channel_wol_get_game_tournament(channel),
-										 channel_wol_get_game_ownerip(channel),topic);
+										 channel_wol_get_game_extension(channel),channel_wol_get_game_ownerip(channel),topic);
            	        		else
          			               eventlog(eventlog_level_warn,__FUNCTION__,&quot;LISTREPLY length exceeded&quot;);
                         }
 						else {
         						if (std::strlen(tempname)+1+20+1+1&lt;MAX_IRC_MESSAGE_LEN)
-	    							snprintf(temp, sizeof(temp), &quot;%s %u 0 %u %u 0 %u 128::&quot;,tempname,channel_get_length(channel),channel_wol_get_game_type(channel),
-											channel_wol_get_game_tournament(channel),channel_wol_get_game_ownerip(channel));
+	    							snprintf(temp, sizeof(temp), &quot;%s %u 0 %u %u %s %u 128::&quot;,tempname,channel_get_length(channel),channel_wol_get_game_type(channel),
+											channel_wol_get_game_tournament(channel),channel_wol_get_game_extension(channel),channel_wol_get_game_ownerip(channel));
 			                    else
             							eventlog(eventlog_level_warn,__FUNCTION__,&quot;LISTREPLY length exceeded&quot;);
 						}
@@ -1042,7 +1053,7 @@
     irc_send(conn,RPL_QUIT,&quot;:goodbye&quot;);
     conn_set_channel(conn, NULL);
     conn_set_state(conn, conn_state_destroy);
-    
+
     return 0;
 }
 
@@ -1051,7 +1062,6 @@
 	if ((conn_wol_get_ingame(conn) == 1)) {
 		conn_wol_set_ingame(conn,0);
     }
-	
     message_send_text(conn,message_type_part,conn,NULL);
 	conn_set_channel(conn, NULL);                        /* In WOL we disconecting from the channel */
     return 0;
@@ -1156,16 +1166,16 @@
     if (conn_get_clienttag(conn) == CLIENTTAG_RENEGADE_UINT) {
 	   snprintf(temp, sizeof(temp), &quot;:%s 0 'Ping server' %s %s %s&quot;, wolip, woltimezone, wollong, wollat);
 	   irc_send(conn,RPL_PINGSERVER,temp);
-	   //snprintf(temp, sizeof(temp), &quot;:%s 4000 'Port Mangler' %s %s %s&quot;, wolip, woltimezone, wollong, wollat); //I dont know for what is this server...?
+	   //snprintf(temp, sizeof(temp), &quot;:%s 4321 'Port Mangler' %s %s %s&quot;, wolip, woltimezone, wollong, wollat); //I dont know for what is this server...?
 	   //irc_send(conn,RPL_MANGLERSERV,temp);
     }
 
     /*  This will be for anyone game */
 	snprintf(temp, sizeof(temp), &quot;:%s %d 'Live chat server' %s %s %s&quot;, wolip, BNETD_WOL_PORT, woltimezone, wollong, wollat);
 	irc_send(conn,RPL_WOLSERV,temp);
-	snprintf(temp, sizeof(temp), &quot;:%s %d 'Gameres server' %s %s %s&quot;, wolip, BNETD_WOL_PORT, woltimezone, wollong, wollat);
+	snprintf(temp, sizeof(temp), &quot;:%s %d 'Gameres server' %s %s %s&quot;, wolip, BNETD_WGAMERES_PORT, woltimezone, wollong, wollat);
 	irc_send(conn,RPL_GAMERESSERV,temp);
-	snprintf(temp, sizeof(temp), &quot;:%s %d 'Ladder server' %s %s %s&quot;, wolip, BNETD_WOL_PORT, woltimezone, wollong, wollat);
+	snprintf(temp, sizeof(temp), &quot;:%s %d 'Ladder server' %s %s %s&quot;, wolip, BNETD_WGAMERES_PORT, woltimezone, wollong, wollat);
 	irc_send(conn,RPL_LADDERSERV,temp);
 	
 	return 0;
@@ -1195,11 +1205,11 @@
 
 	std::memset(_temp,0,sizeof(_temp));
 
-   /* FIXME: Not completed! */
+   /* FIXME: Not completed! Here we will send info about BATLLECLANS */
 
 	if ((numparams=1)) {
         snprintf(_temp, sizeof(_temp), &quot;ID does not exist&quot;);
-	    irc_send(conn,RPL_IDNOEXIST,_temp);
+	    irc_send(conn,ERR_IDNOEXIST,_temp);
     }
 	return 0;
 }
@@ -1215,6 +1225,18 @@
     *   First parameter: 16 == FindDisabled 17 == FindEnabled
     *   Second parameter: 32 == PageDisabled 33 == PageEnabled
     */
+    
+    char ** elems;
+
+    elems = irc_get_listelems(params[0]);
+
+    if ((elems)&amp;&amp;(elems[0])&amp;&amp;(elems[1])) {
+        conn_wol_set_findme(conn,std::atoi(elems[0]));
+        conn_wol_set_pageme(conn,std::atoi(elems[1]));
+    }
+
+	if (elems)
+	     irc_unget_listelems(elems);
  
 	return 0;
 }
@@ -1306,11 +1328,10 @@
 static int _handle_getinsider_command(t_connection * conn, int numparams, char ** params, char * text)
 {
 	char temp[MAX_IRC_MESSAGE_LEN];
-    
-    // Ignore command but, return pramas[1]
-    
+
+    /* Ignore command but, return pramas[1] */
+
     eventlog(eventlog_level_debug,__FUNCTION__,&quot;[** WOL **] GETINSIDER %s&quot;,params[1]);
-    
     irc_send(conn,RPL_GET_INSIDER,params[1]);
 	return 0;
 }
@@ -1330,11 +1351,11 @@
     *   JOINGAME [#Game_channel] 2 [NumberOfPlayers] [gameType] 1 1 [gameIsTournament]
     *   Knowed GameTypes (0-chat, 1-cnc, 2-ra1, 3-racs, 4-raam, 5-solsurv)
     *
-	*   Here is the input expected for WOL:
-	*   JOINGAME #user's_game unknown numberOfPlayers gameType unknown unknown gameIsTournament unknown password
+	*   Here is the input expected:
+	*   JOINGAME #user's_game MinOfPlayers MaxOfPlayers gameType unknown unknown gameIsTournament gameExtension password
 	*
 	*   Heres the output expected:
-	*   user!<A HREF="https://lists.berlios.de/mailman/listinfo/pvpgn-dev">WWOL at hostname</A> JOINGAME unknown numberOfPlayers gameType unknown clanID longIP gameIsTournament :#game_channel_name
+	*   user!<A HREF="https://lists.berlios.de/mailman/listinfo/pvpgn-dev">WWOL at hostname</A> JOINGAME MinOfPlayers MaxOfPlayers gameType unknown clanID longIP gameIsTournament :#game_channel_name
 	*/
 	if((numparams==2)) {
 	    char ** e;
@@ -1348,10 +1369,28 @@
     		char * old_channel_name = NULL;
    			char temp[MAX_IRC_MESSAGE_LEN];
 			char * topic;
+			t_channel * channel;
 	   	 	t_channel * old_channel = conn_get_channel(conn);
-	   	 	
+
+            channel = channellist_find_channel_by_name(wolname,NULL,NULL);
+
+            if (channel == NULL) {
+	             irc_send(conn,ERR_NOSUCHCHANNEL,&quot;:No such channel&quot;);
+			     if (e)
+		               irc_unget_listelems(e);
+     	         return 0;
+            }
+
+            if (channel_get_length(channel) == channel_get_max(channel)) {
+	   	 	     snprintf(temp, sizeof(temp), &quot;%s :Channel is full&quot;,e[0]);
+                 irc_send(conn,ERR_CHANNELISFULL,temp);
+			     if (e)
+		            irc_unget_listelems(e);
+			     return 0;
+            }
+			
 			conn_wol_set_ingame(conn,1);
-
+			
 			if (old_channel)
    	  		   old_channel_name = xstrdup(irc_convert_channel(old_channel));
 
@@ -1360,7 +1399,6 @@
 				conn_wol_set_ingame(conn,0);
 			}
 			else {
-				t_channel * channel;
 				char const * gameOptions;
 
     			channel = conn_get_channel(conn);
@@ -1408,6 +1446,7 @@
 	}
 	else if((numparams&gt;=7)) {
 	    char ** e;
+	    int i;
 
 	    eventlog(eventlog_level_debug,__FUNCTION__,&quot;[** WOL **] JOINGAME: * Create * (%s, %s)&quot;,
 		     params[0],params[1]);
@@ -1453,8 +1492,10 @@
 					channel_wol_set_game_owner(channel,conn_get_chatname(conn));
 					channel_wol_set_game_ownerip(channel,conn_get_addr(conn));
 				    /* HACK: Currently, this is the best way to set the channel game type... */
+					channel_set_max(channel,std::atoi(params[2]));
 					channel_wol_set_game_type(channel,std::atoi(params[3]));
 					channel_wol_set_game_tournament(channel,std::atoi(params[6]));
+                    channel_wol_set_game_extension(channel,params[7]);
 
 					message_send_text(conn,message_wol_joingame,conn,_temp); /* we have to send the JOINGAME acknowledgement */
 					wolname=irc_convert_channel(channel);
@@ -1552,6 +1593,8 @@
     		    }
     		}
 	    }
+    	if (e)
+            irc_unget_listelems(e);
 	}
 	else
 	    irc_send(conn,ERR_NEEDMOREPARAMS,&quot;:Too few arguments to GAMEOPT&quot;);
@@ -1568,12 +1611,12 @@
 	if ((numparams&gt;=1)) {
 	    t_connection * user;
 
-	    if((user = connlist_find_connection_by_accountname(params[0]))) {
+	    if((user = connlist_find_connection_by_accountname(params[0]))&amp;&amp;(conn_wol_get_findme(user) == 17)) {
      		wolname = irc_convert_channel(conn_get_channel(user));
 	        snprintf(_temp, sizeof(_temp), &quot;0 :%s&quot;, wolname); /* User found in channel wolname */
 	    }
 	    else
-	        snprintf(_temp, sizeof(_temp), &quot;1 :&quot;); /* user not loged or have disabled find */
+	        snprintf(_temp, sizeof(_temp), &quot;1 :&quot;); /* user not loged or have not allowed find */
 
 	    irc_send(conn,RPL_FIND_USER,_temp);
     }
@@ -1590,12 +1633,12 @@
 	if ((numparams&gt;=1)) {
 	    t_connection * user;
 
-	    if((user = connlist_find_connection_by_accountname(params[0]))) {
+	    if((user = connlist_find_connection_by_accountname(params[0]))&amp;&amp;(conn_wol_get_findme(user) == 17)) {
      		wolname = irc_convert_channel(conn_get_channel(user));
      		snprintf(_temp, sizeof(_temp), &quot;0 :%s,0&quot;, wolname); /* User found in channel wolname */
 	    }
 	    else
-	        snprintf(_temp, sizeof(_temp), &quot;1 :&quot;); /* user not loged or have disabled find */
+	        snprintf(_temp, sizeof(_temp), &quot;1 :&quot;); /* user not loged or have not allowed find */
 
 	    irc_send(conn,RPL_FIND_USER_EX,_temp);
     }
@@ -1612,12 +1655,12 @@
 	    t_connection * user;
 
 	    snprintf(_temp, sizeof(_temp), &quot;:%s&quot;, text);
-	    if((user = connlist_find_connection_by_accountname(params[0]))) {
+	    if((user = connlist_find_connection_by_accountname(params[0]))&amp;&amp;(conn_wol_get_pageme(user) == 33)) {
      		message_send_text(user,message_wol_page,conn,_temp);
      		snprintf(_temp, sizeof(_temp), &quot;0 :&quot;); /* Page was succesfull */
 	    }
 	    else
-	    snprintf(_temp, sizeof(_temp), &quot;1 :&quot;); /* User not loged in or have disabled page */
+	    snprintf(_temp, sizeof(_temp), &quot;1 :&quot;); /* User not loged in or have not allowed page */
 	    irc_send(conn,RPL_PAGE,_temp);
 	}
 	return 0;
@@ -1627,8 +1670,8 @@
 {
 	char temp[MAX_IRC_MESSAGE_LEN];
 	char _temp_a[MAX_IRC_MESSAGE_LEN];
-	char time_temp[100];
 	t_channel * channel;
+	int numelems = 0;
 
 	std::time_t now;
 
@@ -1637,11 +1680,12 @@
     *  (we are assuming for this example that user1 is the game owner)
     *
  	*   WOLv1:
-    *   :user1!<A HREF="https://lists.berlios.de/mailman/listinfo/pvpgn-dev">WWOL at hostname</A> STARTG u :owner_ip gameNumber time_t
+    *   :user1!<A HREF="https://lists.berlios.de/mailman/listinfo/pvpgn-dev">WWOL at hostname</A> STARTG u :owner_ip :gameNumber time_t
     *
     *   WOLv2:
  	*   user1!<A HREF="https://lists.berlios.de/mailman/listinfo/pvpgn-dev">WWOL at hostname</A> STARTG u :user1 xxx.xxx.xxx.xxx user2 xxx.xxx.xxx.xxx :gameNumber time_t
  	*/
+ 	
 	if((numparams&gt;=1)) {
 	    int i;
 	    char ** e;
@@ -1652,33 +1696,34 @@
 	    e = irc_get_listelems(params[1]);
 	    /* FIXME: support wildcards! */
 
-	    std::strcat(temp,&quot;:&quot;);
-	    
- 	    if (conn_get_clienttag(conn) == CLIENTTAG_WCHAT_UINT) {
+        if (e) {
+           for (numelems=0;e[numelems];numelems++);
+        }
+        
+        std::strcat(temp,&quot;:&quot;);
+        
+ 	    if (numelems == 1) {
   		    t_connection * user;
-   		    
    		    channel = conn_get_channel(conn);
    		    
    		    for (user = channel_get_first(channel);user;user = channel_get_next()) {
 	           char const * name = conn_get_chatname(user);
 	           if (std::strcmp(conn_get_chatname(conn),name) != 0) {
-                  now = std::time(NULL);
-	              snprintf(temp, sizeof(temp), &quot;:%s 1234 %u&quot;, addr_num_to_ip_str(channel_wol_get_game_ownerip(channel)),now);
-	              message_send_text(user,message_wol_start_game,conn,temp);
+	              snprintf(temp, sizeof(temp), &quot;%s &quot;, addr_num_to_ip_str(channel_wol_get_game_ownerip(channel)));
                }
             }
-            return 0;
         }
+        else if (numelems&gt;=2) {
+            for (i=0;((e)&amp;&amp;(e[i]));i++) {
+   		        t_connection * user;
+       		    const char * addr = NULL;
 
-        for (i=0;((e)&amp;&amp;(e[i]));i++) {
-   		    t_connection * user;
-       		const char * addr = NULL;
-
-   	     	if((user = connlist_find_connection_by_accountname(e[i]))) {
-   		       addr = addr_num_to_ip_str(conn_get_addr(user));
-	        }
-   		    snprintf(_temp_a, sizeof(_temp_a), &quot;%s %s &quot;, e[i], addr);
-   		    std::strcat(temp,_temp_a);
+   	     	    if((user = connlist_find_connection_by_accountname(e[i]))) {
+                    addr = addr_num_to_ip_str(conn_get_addr(user));
+	            }
+   		        snprintf(_temp_a, sizeof(_temp_a), &quot;%s %s &quot;, e[i], addr);
+   		        std::strcat(temp,_temp_a);
+            }
         }
         
         std::strcat(temp,&quot;:&quot;);
@@ -1686,25 +1731,27 @@
         std::strcat(temp,&quot; &quot;);
 
         now = std::time(NULL);
-        snprintf(time_temp, sizeof(time_temp), &quot;%u&quot;, now);
-        
-        std::strcat(temp,time_temp);
-
+        snprintf(_temp_a, sizeof(_temp_a), &quot;%u&quot;, now);
+        std::strcat(temp,_temp_a);
+            
 	    eventlog(eventlog_level_debug,__FUNCTION__,&quot;[** WOL **] STARTG: (%s)&quot;,temp);
+	    
+        for (i=0;((e)&amp;&amp;(e[i]));i++) {
+   		        t_connection * user;
+   		        if((user = connlist_find_connection_by_accountname(e[i]))) {
+                    message_send_text(user,message_wol_start_game,conn,temp);
+                }
+        }
 
-	    if ((channel = channellist_find_channel_by_name(irc_convert_ircname(params[0]),NULL,NULL))) {
-     		channel_message_send(channel,message_wol_start_game,conn,temp);
-	    }
-	    else {
-     		irc_send(conn,ERR_NOSUCHCHANNEL,&quot;:No such channel&quot;);
-	    }
+	    if (e)
+            irc_unget_listelems(e);
 	}
    	return 0;
 }
 
 static int _handle_listsearch_command(t_connection * conn, int numparams, char ** params, char * text)
 {
-	// FIXME: Not implemented
+	// THAT IS LADDER SERVER COMMAND!!!!
 	return 0;
 }
 
@@ -1736,7 +1783,7 @@
 {
     char temp[MAX_IRC_MESSAGE_LEN];
     t_channel * channel;
-    
+
    	std::memset(temp,0,sizeof(temp));
 
  	/**
@@ -1746,18 +1793,252 @@
  	*  Heres the output expected
  	*  :[servername] CHANCHK [channel]
  	*/
+
+	if ((channel = channellist_find_channel_by_name(irc_convert_ircname(params[0]),NULL,NULL))) {
+     	std::strcat(temp,params[0]);
+     	message_send_text(conn,message_wol_chanchk,conn,temp);
+	}
+    else {
+     	irc_send(conn,ERR_NOSUCHCHANNEL,&quot;:No such channel&quot;);
+	}
+	return 0;
+}
+
+static int _handle_getbuddy_command(t_connection * conn, int numparams, char ** params, char * text)
+{
+    char temp[MAX_IRC_MESSAGE_LEN];
+	char _temp[MAX_IRC_MESSAGE_LEN];
+	char const * friend_name;
+	t_account * my_acc;
+	t_account * friend_acc;
+	t_list * flist;
+	t_friend * fr;
+	int num;
+	unsigned int uid;
+    int i;
+
+	std::memset(temp,0,sizeof(temp));
+	std::memset(_temp,0,sizeof(_temp));
+          
+    /**
+ 	*  Heres the output expected
+ 	*  :[servername] 333 [user] [buddy_name1]`[buddy_name2]`
+ 	*
+ 	*  Without names:
+    *  :[servername] 333 [user]
+ 	*/
  	
-	if ((channel = channellist_find_channel_by_name(irc_convert_ircname(params[0]),NULL,NULL))) {
-     		std::strcat(temp,params[0]);
-     		message_send_text(conn,message_wol_chanchk,conn,temp);
-	    }
-	    else {
-     		irc_send(conn,ERR_NOSUCHCHANNEL,&quot;:No such channel&quot;);
-	    }
+    my_acc = conn_get_account(conn);
+	num = account_get_friendcount(my_acc);
+
+	flist=account_get_friends(my_acc);
+	
+	if(flist!=NULL) {
+        for (i=0; i&lt;num; i++) {
+    		if ((!(uid = account_get_friend(my_acc,i))) || (!(fr = friendlist_find_uid(flist,uid))))
+    		{
+        	    eventlog(eventlog_level_error,__FUNCTION__,&quot;friend uid in list&quot;);
+        	    continue;
+    		}
+    		friend_acc = friend_get_account(fr);
+    		friend_name = account_get_name(friend_acc);
+		    snprintf(_temp, sizeof(_temp), &quot;%s`&quot;, friend_name);
+   		    std::strcat(temp,_temp);
+        }            
+    }
+    eventlog(eventlog_level_debug,__FUNCTION__,&quot;[** WOL **] GETBUDDY (%s)&quot;,temp);
+	irc_send(conn,RPL_GET_BUDDY,temp);
+	return 0;
+}
+
+static int _handle_addbuddy_command(t_connection * conn, int numparams, char ** params, char * text)
+{
+    char temp[MAX_IRC_MESSAGE_LEN];
+    char const * friend_name;
+    t_account * my_acc;
+    t_account * friend_acc;
+    int num;
+
+   	std::memset(temp,0,sizeof(temp));
     
+    /**
+ 	*  Heres the imput expected
+ 	*  ADDBUDDY [buddy_name]
+ 	*
+ 	*  Heres the output expected
+ 	*  :[servername] 334 [user] [buddy_name]
+ 	*/
+
+ 	friend_name = params[0];
+    my_acc = conn_get_account(conn);
+
+   	friend_acc = accountlist_find_account(friend_name);
+    account_add_friend(my_acc, friend_acc);
+    
+   	/* FIXME: Check if add friend is done if not then send right message */
+
+    snprintf(temp,sizeof(temp),&quot;%s&quot;, friend_name);
+	irc_send(conn,RPL_ADD_BUDDY,temp);
+	
 	return 0;
 }
 
+static int _handle_delbuddy_command(t_connection * conn, int numparams, char ** params, char * text)
+{
+    char temp[MAX_IRC_MESSAGE_LEN];
+    char const * friend_name;
+    t_account * my_acc;
+    int num;
+    
+   	std::memset(temp,0,sizeof(temp));
+    
+    /**
+ 	*  Heres the imput expected
+ 	*  DELBUDDY [buddy_name]
+ 	*
+ 	*  Heres the output expected
+ 	*  :[servername] 335 [user] [buddy_name]
+ 	*/
+ 	
+ 	friend_name = params[0];
+    my_acc = conn_get_account(conn);
+    
+ 	num = account_remove_friend2(my_acc, friend_name);
+
+  	/**
+    *  FIXME: Check if remove friend is done if not then send right message 
+    *  Btw I dont know another then RPL_DEL_BUDDY message yet lol.
+    */
+
+    snprintf(temp,sizeof(temp),&quot;%s&quot;, friend_name);
+	irc_send(conn,RPL_DEL_BUDDY,temp);
+	return 0;
 }
 
+static int _handle_time_command(t_connection * conn, int numparams, char ** params, char * text)
+{
+    char temp[MAX_IRC_MESSAGE_LEN];
+	std::time_t now;
+
+   	std::memset(temp,0,sizeof(temp));
+    now = std::time(NULL);
+
+    snprintf(temp,sizeof(temp),&quot;irc.westwood.com :%u&quot;, now);
+	irc_send(conn,RPL_TIME,temp);
+    return 0;
 }
+
+static int _handle_kick_command(t_connection * conn, int numparams, char ** params, char * text)
+{
+    char temp[MAX_IRC_MESSAGE_LEN];
+    t_channel * channel;
+    t_connection * c;
+    unsigned int flags;
+
+ 	/**
+ 	*  Heres the imput expected
+    *  KICK [channel] [kicked_user]
+    *
+    *  Heres the output expected
+    *  :user!<A HREF="https://lists.berlios.de/mailman/listinfo/pvpgn-dev">WWOL at hostname</A> KICK [channel] [kicked_user] :[user_op]
+    */
+
+	flags = conn_get_flags(conn);
+	
+	if (!flags &amp; MF_BLIZZARD) {
+	    snprintf(temp,sizeof(temp),&quot;That command is for Admins/Operators only.&quot;);
+        message_send_text(conn,message_type_whisper,conn,temp);
+        return 0;
+    }
+
+    if (params[1])
+      c = connlist_find_connection_by_name(params[1],NULL);
+
+	if ((channel = channellist_find_channel_by_name(irc_convert_ircname(params[0]),NULL,NULL))) {
+	    snprintf(temp, sizeof(temp), &quot;%s %s :%s&quot;, params[0], params[1], conn_get_loggeduser(conn));
+   	    channel_message_send(channel,message_wol_kick,conn,temp);
+	    if ((conn_wol_get_ingame(c) == 1)) {
+		   conn_wol_set_ingame(c,0);
+        }
+        conn_set_channel(c, NULL);
+	}
+    else {
+     	irc_send(conn,ERR_NOSUCHCHANNEL,&quot;:No such channel&quot;);
+	}
+    return 0;
+}
+
+static int _handle_mode_command(t_connection * conn, int numparams, char ** params, char * text)
+{
+    char temp[MAX_IRC_MESSAGE_LEN];
+
+   	std::memset(temp,0,sizeof(temp));
+    t_channel * channel;
+	
+    /** 
+    * FIXME: CHECK IF USER IS OPERATOR
+    * because in WOLv1 is used mode command to add OP or Voice to another user !!!!
+    * in WOLv2 is used for change game mode (cooperative, free for all...)
+    */
+    
+	if ((channel = channellist_find_channel_by_name(irc_convert_ircname(params[0]),NULL,NULL))) {
+        snprintf(temp,sizeof(temp),&quot;%s %s %s&quot;, params[0], params[1], params[2]);
+   	    channel_message_send(channel,message_type_mode,conn,temp);
+	}
+    else {
+     	irc_send(conn,ERR_NOSUCHCHANNEL,&quot;:No such channel&quot;);
+	}
+    return 0;
+}
+
+static int _handle_host_command(t_connection * conn, int numparams, char ** params, char * text)
+{
+    char temp[MAX_IRC_MESSAGE_LEN];
+    t_connection * user;
+
+   	std::memset(temp,0,sizeof(temp));
+
+	if ((user = connlist_find_connection_by_accountname(params[0]))) {
+        snprintf(temp,sizeof(temp),&quot;I am hosting at %s&quot;, text);
+        message_send_text(user,message_type_whisper,conn,temp);
+	}
+	else {
+		irc_send(conn,ERR_NOSUCHNICK,&quot;:No such user&quot;);
+	}
+    return 0;
+}
+
+static int _handle_advertc_command(t_connection * conn, int numparams, char ** params, char * text)
+{
+    /* FIXME: Not implemented yet */
+    return 0;
+}
+
+static int _handle_clanbyname_command(t_connection * conn, int numparams, char ** params, char * text)
+{
+    /* FIXME: Not implemented yet */
+    return 0;
+}
+
+static int _handle_userip_command(t_connection * conn, int numparams, char ** params, char * text)
+{
+    char temp[MAX_IRC_MESSAGE_LEN];
+    t_connection * user;
+    const char * addr = NULL;
+    
+   	std::memset(temp,0,sizeof(temp));
+   	
+    if((user = connlist_find_connection_by_accountname(params[0]))) {
+        addr = addr_num_to_ip_str(conn_get_addr(user));
+        snprintf(temp,sizeof(temp),&quot;%s&quot;,addr);
+	    message_send_text(conn,message_wol_userip,conn,temp);
+	}
+	else {
+		irc_send(conn,ERR_NOSUCHNICK,&quot;:No such user&quot;);
+	}
+    return 0;
+}
+
+}
+
+}

Modified: trunk/pvpgn/src/bnetd/irc.cpp
===================================================================
--- trunk/pvpgn/src/bnetd/irc.cpp	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/irc.cpp	2007-02-13 18:53:59 UTC (rev 254)
@@ -143,8 +143,8 @@
 	return -1;
     }
 
-   if ((conn_get_clienttag(conn) != CLIENTTAG_WCHAT_UINT) &amp;&amp; 
-       (conn_get_clienttag(conn) != CLIENTTAG_IIRC_UINT))
+    if ((conn_get_clienttag(conn) != CLIENTTAG_WCHAT_UINT) &amp;&amp; 
+        (conn_get_clienttag(conn) != CLIENTTAG_IIRC_UINT))
         return 0;
 
     if (!(p = packet_create(packet_class_raw))) {
@@ -495,23 +495,24 @@
     char * msg;
 
     if (!command) {
-	eventlog(eventlog_level_error,__FUNCTION__,&quot;got NULL command&quot;);
-	return NULL;
+	    eventlog(eventlog_level_error,__FUNCTION__,&quot;got NULL command&quot;);
+	    return NULL;
     }
     if (from) {
-	if ((!from-&gt;nick)||(!from-&gt;user)||(!from-&gt;host)) {
-	    eventlog(eventlog_level_error,__FUNCTION__,&quot;got malformed from&quot;);
-	    return NULL;
-	}
-	myfrom = (char*)xmalloc(std::strlen(from-&gt;nick)+1+std::strlen(from-&gt;user)+1+std::strlen(from-&gt;host)+1); /* nick + &quot;!&quot; + user + &quot;@&quot; + host + &quot;\0&quot; */
-	std::sprintf(myfrom,&quot;%s!%s@%s&quot;,from-&gt;nick,from-&gt;user,from-&gt;host);
+	    if ((!from-&gt;nick)||(!from-&gt;user)||(!from-&gt;host)) {
+	        eventlog(eventlog_level_error,__FUNCTION__,&quot;got malformed from&quot;);
+	        return NULL;
+	    }
+	    myfrom = (char*)xmalloc(std::strlen(from-&gt;nick)+1+std::strlen(from-&gt;user)+1+std::strlen(from-&gt;host)+1); /* nick + &quot;!&quot; + user + &quot;@&quot; + host + &quot;\0&quot; */
+	    std::sprintf(myfrom,&quot;%s!%s@%s&quot;,from-&gt;nick,from-&gt;user,from-&gt;host);
     } else
     	myfrom = xstrdup(server_get_hostname());
     if (dest)
     	mydest = dest;
+    	
     if (text)
     	mytext = text;
-
+    	
     len = 1+std::strlen(myfrom)+1+
     	  std::strlen(command)+1+
     	  std::strlen(mydest)+1+
@@ -519,6 +520,7 @@
 
 
     msg = (char*)xmalloc(len);
+    
     std::sprintf(msg,&quot;:%s\n%s\n%s\n%s&quot;,myfrom,command,mydest,mytext);
     xfree(myfrom);
     return msg;
@@ -534,6 +536,7 @@
     char * e4;
     char const * tname = NULL;
     char const * toname = &quot;AUTH&quot;; /* fallback name */
+    char * temp;
 
     if (!packet) {
 	eventlog(eventlog_level_error,__FUNCTION__,&quot;got NULL packet&quot;);
@@ -582,16 +585,18 @@
     	toname = e3;
 
     if (std::strcmp(toname,&quot;\r&quot;)==0) {
-	toname = &quot;&quot;; /* HACK: the target field is really empty */
-    }
+    	toname = &quot;&quot;; /* HACK: the target field is really empty */
+    	temp = &quot;&quot;;
+    } else 
+    	temp = &quot; &quot;;
 
-    if (std::strlen(e1)+1+std::strlen(e2)+1+std::strlen(toname)+1+std::strlen(e4)+2+1 &lt;= MAX_IRC_MESSAGE_LEN) {
+    if (std::strlen(e1)+1+std::strlen(e2)+1+std::strlen(toname)+std::strlen(temp)+std::strlen(e4)+2+1 &lt;= MAX_IRC_MESSAGE_LEN) {
 	char msg[MAX_IRC_MESSAGE_LEN+1];
 
 	if (e1_2)
-	    std::sprintf(msg,&quot;%<A HREF="https://lists.berlios.de/mailman/listinfo/pvpgn-dev">s at hidden</A> %s %s %s\r\n&quot;,e1,e2,toname,e4);
+	    std::sprintf(msg,&quot;%<A HREF="https://lists.berlios.de/mailman/listinfo/pvpgn-dev">s at hidden</A> %s %s%s%s\r\n&quot;,e1,e2,toname,temp,e4);
 	else
-	    std::sprintf(msg,&quot;%s %s %s %s\r\n&quot;,e1,e2,toname,e4);
+	    std::sprintf(msg,&quot;%s %s %s%s%s\r\n&quot;,e1,e2,toname,temp,e4);
 	eventlog(eventlog_level_debug,__FUNCTION__,&quot;sent \&quot;%s\&quot;&quot;,msg);
 	packet_set_size(packet,0);
 	packet_append_data(packet,msg,std::strlen(msg));
@@ -813,22 +818,29 @@
     	from.nick = conn_get_chatname(me);
     	from.user = ctag;
     	from.host = addr_num_to_ip_str(conn_get_addr(me));
-    	msg = irc_message_preformat(&amp;from,&quot;PAGE&quot;,&quot;&quot;,text);
+    	msg = irc_message_preformat(&amp;from,&quot;PAGE&quot;,NULL,text);
     	conn_unget_chatname(me,from.nick);
     	break;
     case message_wol_advertr:
+    	msg = irc_message_preformat(NULL,&quot;ADVERTR&quot;,&quot;\r&quot;,text);
+    	break;
+   	case message_wol_chanchk:
+        msg = irc_message_preformat(NULL,&quot;CHANCHK&quot;,&quot;\r&quot;,text);
+        break;
+   	case message_wol_kick:
     	from.nick = conn_get_chatname(me);
     	from.user = ctag;
     	from.host = addr_num_to_ip_str(conn_get_addr(me));
-    	msg = irc_message_preformat(&amp;from,&quot;ADVERTR&quot;,&quot;\r&quot;,text);
+    	msg = irc_message_preformat(&amp;from,&quot;KICK&quot;,&quot;\r&quot;,text);
     	conn_unget_chatname(me,from.nick);
-   	case message_wol_chanchk:
+        break;
+   	case message_wol_userip:
     	from.nick = conn_get_chatname(me);
     	from.user = ctag;
     	from.host = addr_num_to_ip_str(conn_get_addr(me));
-    	msg = irc_message_preformat(&amp;from,&quot;CHANCHK&quot;,&quot;\r&quot;,text);
+    	msg = irc_message_preformat(&amp;from,&quot;USERIP&quot;,&quot;\r&quot;,text);
     	conn_unget_chatname(me,from.nick);
-    break;
+        break;
     default:
     	eventlog(eventlog_level_warn,__FUNCTION__,&quot;%d not yet implemented&quot;,type);
 	return -1;
@@ -890,8 +902,12 @@
 
             if((conn_get_wol(c) == 1)) {
                 if ((channel_wol_get_game_owner(channel) != NULL) &amp;&amp; (std::strcmp(channel_wol_get_game_owner(channel),name) == 0)) {
-                            std::strcat(temp,&quot;@&quot;);
+                       std::strcat(temp,&quot;@&quot;);
                     }
+                else if ((conn_wol_get_ingame(c) == 0)) {
+                   	if (flags &amp; MF_BLIZZARD)
+		               std::strcat(temp,&quot;@&quot;);
+               }
                 if (conn_get_clienttag(c) != CLIENTTAG_WCHAT_UINT) {
                     std::sprintf(temp,&quot;%s%s,0,%u&quot;,temp,name,conn_get_addr(m));
                 }
@@ -901,8 +917,8 @@
     	    }
     	    else
     	    {
-	    std::strcat(temp,flg);
-	    std::strcat(temp,name);
+	            std::strcat(temp,flg);
+	            std::strcat(temp,name);
     	    }
 
 	    first = 0;

Modified: trunk/pvpgn/src/bnetd/message.cpp
===================================================================
--- trunk/pvpgn/src/bnetd/message.cpp	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/message.cpp	2007-02-13 18:53:59 UTC (rev 254)
@@ -1400,6 +1400,7 @@
      case conn_class_irc:
      case conn_class_wol:
      case conn_class_wserv:
+     case conn_class_wgameres:
 	if (!(packet = packet_create(packet_class_raw)))
 	{
 	    eventlog(eventlog_level_error,__FUNCTION__,&quot;could not create packet&quot;);
@@ -1468,7 +1469,7 @@
 	return -1;
 
     /* FIXME: this is not needed now, message has dst */
-    if ((conn_get_class(dst)==conn_class_irc)||(conn_get_class(dst)==conn_class_wol)||(conn_get_class(dst)==conn_class_wserv)) {
+    if ((conn_get_class(dst)==conn_class_irc)||(conn_get_class(dst)==conn_class_wol)||(conn_get_class(dst)==conn_class_wserv)||(conn_get_class(dst)==conn_class_wgameres)) {
     	/* HACK: IRC message always need the recipient and are therefore bad to cache. */
 	/*       So we only cache a pseudo packet and convert it to a real packet later ... */
 	packet = packet_duplicate(packet); /* we want to modify packet so we have to create a copy ... */
@@ -1480,7 +1481,7 @@
 
     conn_push_outqueue(dst,packet);
 
-    if ((conn_get_class(dst)==conn_class_irc)||(conn_get_class(dst)==conn_class_wol)||(conn_get_class(dst)==conn_class_wserv))
+    if ((conn_get_class(dst)==conn_class_irc)||(conn_get_class(dst)==conn_class_wol)||(conn_get_class(dst)==conn_class_wserv)||(conn_get_class(dst)==conn_class_wgameres))
     	packet_del_ref(packet); /* we don't need the previously created copy anymore ... */
 
     return 0;

Modified: trunk/pvpgn/src/bnetd/message.h
===================================================================
--- trunk/pvpgn/src/bnetd/message.h	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/message.h	2007-02-13 18:53:59 UTC (rev 254)
@@ -75,6 +75,8 @@
     message_wol_page,
     message_wol_advertr,
     message_wol_chanchk,
+    message_wol_kick,
+    message_wol_userip,
 
     message_type_null
 } t_message_type;

Modified: trunk/pvpgn/src/bnetd/prefs.cpp
===================================================================
--- trunk/pvpgn/src/bnetd/prefs.cpp	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/prefs.cpp	2007-02-13 18:53:59 UTC (rev 254)
@@ -161,6 +161,7 @@
 
     char const * woladdrs;
     char const * wservaddrs;
+    char const * wgameresaddrs;
     char const * woltimezone;
     char const * wollongitude;
     char const * wollatitude;
@@ -634,6 +635,9 @@
 static int conf_set_irc_network_name(const char *valstr);
 static const char *conf_get_irc_network_name(void);
 
+static int conf_setdef_wgameres_addrs(void);
+static int conf_set_wgameres_addrs(const char *valstr);
+static const char *conf_get_wgameres_addrs(void);
 
 static int conf_setdef_wserv_addrs(void);
 static int conf_set_wserv_addrs(const char *valstr);
@@ -776,6 +780,7 @@
     { &quot;ladder_prefix&quot;,		conf_set_ladder_prefix,	       conf_get_ladder_prefix,conf_setdef_ladder_prefix},
     { &quot;irc_network_name&quot;,		conf_set_irc_network_name,	       conf_get_irc_network_name, conf_setdef_irc_network_name},
 
+    { &quot;wgameresaddrs&quot;,		conf_set_wgameres_addrs,	       conf_get_wgameres_addrs, conf_setdef_wgameres_addrs},
     { &quot;wservaddrs&quot;,		conf_set_wserv_addrs,	       conf_get_wserv_addrs, conf_setdef_wserv_addrs},
     { &quot;woladdrs&quot;,		conf_set_wol_addrs,	       conf_get_wol_addrs, conf_setdef_wol_addrs},
     { &quot;woltimezone&quot;,		conf_set_wol_timezone,         conf_get_wol_timezone, conf_setdef_wol_timezone},
@@ -3321,6 +3326,26 @@
 /**
 *  Westwood Online Extensions
 */
+extern char const * prefs_get_wgameres_addrs(void)
+{
+    return prefs_runtime_config.wgameresaddrs;
+}
+
+static int conf_set_wgameres_addrs(const char *valstr)
+{
+    return conf_set_str(&amp;prefs_runtime_config.wgameresaddrs,valstr,NULL);
+}
+
+static int conf_setdef_wgameres_addrs(void)
+{
+    return conf_set_str(&amp;prefs_runtime_config.wgameresaddrs,NULL,BNETD_WOL_ADDRS);
+}
+
+static const char* conf_get_wgameres_addrs(void)
+{
+    return prefs_runtime_config.wgameresaddrs;
+}
+
 extern char const * prefs_get_wserv_addrs(void)
 {
     return prefs_runtime_config.wservaddrs;
@@ -3361,7 +3386,6 @@
     return prefs_runtime_config.woladdrs;
 }
 
-
 static int  conf_set_wol_timezone(const char *valstr)
 {
     return conf_set_str(&amp;prefs_runtime_config.woltimezone,valstr,NULL);

Modified: trunk/pvpgn/src/bnetd/prefs.h
===================================================================
--- trunk/pvpgn/src/bnetd/prefs.h	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/prefs.h	2007-02-13 18:53:59 UTC (rev 254)
@@ -181,6 +181,7 @@
 /**
 *  Westwood Online Extensions
 */
+extern char const * prefs_get_wgameres_addrs(void);
 extern char const * prefs_get_wserv_addrs(void);
 extern char const * prefs_get_wol_addrs(void);
 extern char const * prefs_get_wol_timezone(void);

Modified: trunk/pvpgn/src/bnetd/server.cpp
===================================================================
--- trunk/pvpgn/src/bnetd/server.cpp	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/server.cpp	2007-02-13 18:53:59 UTC (rev 254)
@@ -204,6 +204,8 @@
 	return &quot;wol&quot;;
     case laddr_type_wserv:
 	return &quot;wserv&quot;;
+    case laddr_type_wgameres:
+	return &quot;wgameres&quot;;
     case laddr_type_telnet:
 	return &quot;telnet&quot;;
     default:
@@ -350,6 +352,10 @@
 	    conn_set_class(c,conn_class_wserv);
 	    conn_set_state(c,conn_state_connected);
 	    break;
+	case laddr_type_wgameres:
+	    conn_set_class(c,conn_class_wgameres);
+	    conn_set_state(c,conn_state_connected);
+	    break;
 	case laddr_type_w3route:
 		conn_set_class(c,conn_class_w3route);
 		conn_set_state(c,conn_state_connected);
@@ -522,6 +528,7 @@
 	case conn_class_irc:
 	case conn_class_wol:
 	case conn_class_wserv:
+	case conn_class_wgameres:
 	case conn_class_telnet:
 	    if (!(packet = packet_create(packet_class_raw)))
 	    {
@@ -636,6 +643,7 @@
 		case conn_class_irc:
 		    ret = handle_irc_packet(c,packet);
 		    break;
+		case conn_class_wgameres:
 		case conn_class_wserv:
 		case conn_class_wol:
 		    ret = handle_wol_packet(c,packet);
@@ -1461,6 +1469,14 @@
 	_shutdown_addrs(laddrs);
 	return -1;
     }
+    
+    /* Append list of addresses to listen for WGAMERES connections */
+    if (_setup_add_addrs(&amp;laddrs, prefs_get_wgameres_addrs(),INADDR_ANY,BNETD_WGAMERES_PORT, laddr_type_wgameres))
+    {
+	eventlog(eventlog_level_error,__FUNCTION__,&quot;could not create %s server address list from \&quot;%s\&quot;&quot;,laddr_type_get_str(laddr_type_wgameres),prefs_get_wgameres_addrs());
+	_shutdown_addrs(laddrs);
+	return -1;
+    }
 
     /* Append list of addresses to listen for W3ROUTE connections */
     if (_setup_add_addrs(&amp;laddrs,prefs_get_w3route_addr(),INADDR_ANY,BNETD_W3ROUTE_PORT, laddr_type_w3route))

Modified: trunk/pvpgn/src/bnetd/server.h
===================================================================
--- trunk/pvpgn/src/bnetd/server.h	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/bnetd/server.h	2007-02-13 18:53:59 UTC (rev 254)
@@ -35,7 +35,8 @@
     laddr_type_w3route, /* warcraft 3 playgame routing (def. port 6200) */
     laddr_type_irc,   	/* Internet Relay Chat service (port is varying; mostly on port 6667 or 7000) */
     laddr_type_wol,	    /* Westwood Online (IRC) Chat Services (port is 4000) */
-    laddr_type_wserv,   /* Westwood Server (IRC) Services (port is 4005) */
+    laddr_type_wserv,   /* Westwood servserv (IRC) Services (port is 4005) */
+    laddr_type_wgameres,/* Westwood gameres Services (port is 4807) */
     laddr_type_telnet 	/* telnet service (usually on port 23) */
 } t_laddr_type;
 

Modified: trunk/pvpgn/src/common/irc_protocol.h
===================================================================
--- trunk/pvpgn/src/common/irc_protocol.h	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/common/irc_protocol.h	2007-02-13 18:53:59 UTC (rev 254)
@@ -336,6 +336,8 @@
 #define RPL_SET_CODEPAGE     329
 
 #define RPL_GET_BUDDY        333
+#define RPL_ADD_BUDDY        334
+#define RPL_DEL_BUDDY        335
 
 #define RPL_BATTLECLAN	     358
 
@@ -360,7 +362,7 @@
 
 #define RPL_PINGSERVER	     615
 
-#define RPL_IDNOEXIST        439
+#define ERR_IDNOEXIST        439
 
 /** error's */
 /*

Modified: trunk/pvpgn/src/common/setup_before.h
===================================================================
--- trunk/pvpgn/src/common/setup_before.h	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/common/setup_before.h	2007-02-13 18:53:59 UTC (rev 254)
@@ -184,6 +184,8 @@
 const int BNETD_WOL_PORT = 4000;
 const char * const BNETD_WSERV_ADDRS = &quot;&quot;;
 const int BNETD_WSERV_PORT = 4005;
+const char * const BNETD_WGAMERES_ADDRS = &quot;&quot;;
+const int BNETD_WGAMERES_PORT = 4807;
 const char * const BNETD_TRACK_ADDRS = &quot;track.pvpgn.org&quot;;
 const int BNETD_TRACK_PORT = 6114; /* use this port if not specified */
 const int BNETD_DEF_TEST_PORT = 6112; /* default guess for UDP test port */

Modified: trunk/pvpgn/src/common/tag.cpp
===================================================================
--- trunk/pvpgn/src/common/tag.cpp	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/common/tag.cpp	2007-02-13 18:53:59 UTC (rev 254)
@@ -77,8 +77,10 @@
              return CLIENTTAG_WCHAT;             
         case CLIENTTAG_TIBERNSUN_UINT:
              return CLIENTTAG_TIBERNSUN;
-         case CLIENTTAG_TIBSUNXP_UINT:
+        case CLIENTTAG_TIBSUNXP_UINT:
              return CLIENTTAG_TIBSUNXP;
+        case CLIENTTAG_REDALERT_UINT:
+             return CLIENTTAG_REDALERT;
         case CLIENTTAG_REDALERT2_UINT:
              return CLIENTTAG_REDALERT2;
         case CLIENTTAG_DUNE2000_UINT:
@@ -96,12 +98,12 @@
         case CLIENTTAG_WWOL_UINT:
              return CLIENTTAG_WWOL;
 	    default:
-		return CLIENTTAG_UNKNOWN;
+             return CLIENTTAG_UNKNOWN;
 	}
 }
 
 /*****/
-/* make all letters in string upper case - used in command.c*/
+/* make all letters in string upper case - used in command.cpp*/
 extern t_tag tag_case_str_to_uint(char const * tag_str)
 {
     unsigned int i, len;
@@ -207,6 +209,7 @@
     case CLIENTTAG_WCHAT_UINT:
     case CLIENTTAG_TIBERNSUN_UINT:
     case CLIENTTAG_TIBSUNXP_UINT:
+    case CLIENTTAG_REDALERT_UINT:
     case CLIENTTAG_REDALERT2_UINT:
     case CLIENTTAG_DUNE2000_UINT:
     case CLIENTTAG_NOX_UINT:
@@ -279,6 +282,8 @@
         return &quot;Tiberian Sun&quot;;
       case CLIENTTAG_TIBSUNXP_UINT:
         return &quot;Tiberian Sun: Firestorm&quot;;
+      case CLIENTTAG_REDALERT_UINT:
+        return &quot;Red Alert&quot;;
       case CLIENTTAG_REDALERT2_UINT:
         return &quot;Red Alert 2&quot;;
       case CLIENTTAG_DUNE2000_UINT:

Modified: trunk/pvpgn/src/common/tag.h
===================================================================
--- trunk/pvpgn/src/common/tag.h	2007-01-25 13:12:55 UTC (rev 253)
+++ trunk/pvpgn/src/common/tag.h	2007-02-13 18:53:59 UTC (rev 254)
@@ -87,6 +87,8 @@
 #define CLIENTTAG_TIBERNSUN_UINT    0x5453554E
 #define CLIENTTAG_TIBSUNXP          &quot;TSXP&quot; /* Tiberian Sun Extension Pack */
 #define CLIENTTAG_TIBSUNXP_UINT     0x54535850
+#define CLIENTTAG_REDALERT          &quot;RALT&quot; /* Red Alert 1 */
+#define CLIENTTAG_REDALERT_UINT     0x52414C54
 #define CLIENTTAG_REDALERT2         &quot;RAL2&quot; /* Red Alert 2 */
 #define CLIENTTAG_REDALERT2_UINT    0x52414C32
 #define CLIENTTAG_DUNE2000          &quot;DN2K&quot; /* Dune 2000 */


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000022.html">[pvpgn-dev] [Patch #1643] support for Emperor and Red Alert 1 v3.03
</A></li>
	<LI>Next message: <A HREF="000027.html">[pvpgn-dev] [Patch #1643] support for Emperor and Red Alert 1 v3.03
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26">[ date ]</a>
              <a href="thread.html#26">[ thread ]</a>
              <a href="subject.html#26">[ subject ]</a>
              <a href="author.html#26">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/pvpgn-dev">More information about the pvpgn-dev
mailing list</a><br>
</body></html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [pvpgn-dev] [Bug #14689] [SVN r508] WOL DoS / Server Crash when WOL	game finishes
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/pvpgn-dev/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:pvpgn-dev%40lists.berlios.de?Subject=Re%3A%20%5Bpvpgn-dev%5D%20%5BBug%20%2314689%5D%20%5BSVN%20r508%5D%20WOL%20DoS%20/%20Server%20Crash%20when%20WOL%0A%09game%20finishes&In-Reply-To=%3C200810212054.m9LKsbJW020213%40unicorn.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000865.html">
   <LINK REL="Next"  HREF="000867.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[pvpgn-dev] [Bug #14689] [SVN r508] WOL DoS / Server Crash when WOL	game finishes</H1>
    <B>admin at berlios.de</B> 
    <A HREF="mailto:pvpgn-dev%40lists.berlios.de?Subject=Re%3A%20%5Bpvpgn-dev%5D%20%5BBug%20%2314689%5D%20%5BSVN%20r508%5D%20WOL%20DoS%20/%20Server%20Crash%20when%20WOL%0A%09game%20finishes&In-Reply-To=%3C200810212054.m9LKsbJW020213%40unicorn.berlios.de%3E"
       TITLE="[pvpgn-dev] [Bug #14689] [SVN r508] WOL DoS / Server Crash when WOL	game finishes">admin at berlios.de
       </A><BR>
    <I>Tue Oct 21 22:54:37 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000865.html">[pvpgn-dev] [Bug #14689] [SVN r508] WOL DoS / Server Crash when WOL	game finishes
</A></li>
        <LI>Next message: <A HREF="000867.html">[pvpgn-dev] Hi all! New guy...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#866">[ date ]</a>
              <a href="thread.html#866">[ thread ]</a>
              <a href="subject.html#866">[ subject ]</a>
              <a href="author.html#866">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Bug #14689, was updated on 2008-Oct-16 11:40
Here is a current snapshot of the bug.

Project: Player vs Player Gaming Network
Category: Westwood Online
Status: Open
Resolution: None
Bug Group: bnetd
Priority: 5
Submitted by: justabaka
Assigned to : pelish
Summary: [SVN r508] WOL DoS / Server Crash when WOL game finishes

Details: We're testing WOL games support. Every time the game finishes there's a wol protocol denial of service or even a server crash. The only unaffected game is Nox.

A debug-level log is here: <A HREF="http://pastebin.com/m36fea435">http://pastebin.com/m36fea435</A>

Follow-Ups:

Date: 2008-Oct-21 22:54
By: pelish

Comment:
I have found where is this bug. But the issue is more than complicated. This whole problem is in packet data buffer overflow. Solution of this bug will take some biger recoding of westwood gameres packet handler.

Anyways thank You for your testing! I will give a feedback when it will be fixed.
-------------------------------------------------------

Date: 2008-Oct-20 12:55
By: justabaka

Comment:
All the time it just crashed with 'bnetd.exe caused an error and has been closed' or it just magically die.

By the way, we build and test it under windows at office PCs, but production builds go to our linux servers.
-------------------------------------------------------

Date: 2008-Oct-20 12:29
By: pelish

Comment:
Thanks for quick feedback. This my fix was general for all WOL clients, but it seems to be not fixed completely. The question is if PvPGN still crashes, or just does not show proper game resolutions.
-------------------------------------------------------

Date: 2008-Oct-20 11:29
By: justabaka

Comment:
Runned tests, here's the result.

Seems like it was quick and dirty fix for only one game. All WOL games need to be fixed the same way :)

Unaffected/fixed:
Red Alert 2
Renegade
Tiberian Sun

Affected games:
Red Alert 1 (via Westwood Chat)
Red Alert 2 Juri's Revenge
Tiberian Sun Firestorm

Unkn:
C&amp;C (via Westwood Chat) - chat gets a nice violation error, can't test

<A HREF="http://slil.ru/26253814">http://slil.ru/26253814</A> Capture
<A HREF="http://slil.ru/26253820">http://slil.ru/26253820</A> Logs
-------------------------------------------------------

Date: 2008-Oct-20 07:21
By: justabaka

Comment:
I confirm, bug is gone, packets seem to be properly handled.

Great job, many thanks ;)
-------------------------------------------------------

Date: 2008-Oct-18 19:07
By: pelish

Comment:
This should be fixed at SVN revision 510. Testing welcome!
-------------------------------------------------------

Date: 2008-Oct-17 13:20
By: justabaka

Comment:
A correspondent log is here: <A HREF="http://pastebin.com/m71ad1945">http://pastebin.com/m71ad1945</A>
-------------------------------------------------------

Date: 2008-Oct-17 12:24
By: justabaka

Comment:
<A HREF="http://slil.ru/26245668">http://slil.ru/26245668</A>
-------------------------------------------------------

Date: 2008-Oct-16 12:31
By: justabaka

Comment:
Sure, I'll do that tomorrow. Thanks for such a fast reply.
-------------------------------------------------------

Date: 2008-Oct-16 12:00
By: pelish

Comment:
This should be some bug in WOL Gamres services. Can you make packet dump when WOL crash for me?

Thank you
-------------------------------------------------------

Date: 2008-Oct-16 11:47
By: justabaka

Comment:
P.S. This log was written before the crash.
-------------------------------------------------------

For detailed info, follow this link:
<A HREF="http://developer.berlios.de/bugs/?func=detailbug&amp;bug_id=14689&amp;group_id=2291">http://developer.berlios.de/bugs/?func=detailbug&amp;bug_id=14689&amp;group_id=2291</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000865.html">[pvpgn-dev] [Bug #14689] [SVN r508] WOL DoS / Server Crash when WOL	game finishes
</A></li>
	<LI>Next message: <A HREF="000867.html">[pvpgn-dev] Hi all! New guy...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#866">[ date ]</a>
              <a href="thread.html#866">[ thread ]</a>
              <a href="subject.html#866">[ subject ]</a>
              <a href="author.html#866">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/pvpgn-dev">More information about the pvpgn-dev
mailing list</a><br>
</body></html>
